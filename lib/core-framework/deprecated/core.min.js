(function(){this.Core={};Core.Class=function(){};Core.apply=function(a,b,c){c&&Core.apply(a,c);if(a&&b&&typeof b==="object")for(var d in b)a[d]=b[d];return a};Core.delegate=function(a,b,c){return typeof b==="function"?function(){arguments.push=Array.prototype.push;for(var d in c)arguments.push(c[d]);return b.apply(a,arguments)}:function(){return!1}};Core.pattern=function(){return{isString:function(a){return typeof a==="string"},isArray:function(a){return a.constructor==Array},isFilemap:function(a){if(this.isObject(a)&&
!this.isString(a))for(var b in a){if(!this.isString(b))return!1;if(!this.isArray(a[b]))return!1}else return!1;return!0},isNumber:function(a){return Object.prototype.toString.call(a)==="[object Number]"},isObject:function(a){return Object.prototype.toString.call(a)==="[object Object]"},isClass:function(a){return typeof a=="function"&&typeof a.prototype=="object"?!0:!1},isFunction:function(a){return Object.prototype.toString.apply(a)==="[object Function]"},isBoolean:function(a){return Object.prototype.toString.apply(a)===
"[object Boolean]"},isURI:function(a){return a.match(RegExp("(ftp|http|https)","ig"))?!0:!1}}}();Core.mixin=function(){var a=function(){return{proto:null,mixins:null,augment:function(a){this.proto=a.shift();this.mixins=a.shift();a.shift();a.shift();this.override();return this.proto},compose:function(){},override:function(){for(var a in this.mixins)proto=this.mixins[a].prototype||this.mixins[a],Core.apply(this.proto.prototype,proto),this.proto.prototype.mixinPrototypes[a]=proto}}}();return function(){var b=
Array.prototype.slice.call(arguments);b.unshift(this);return a.augment(b)}}();Core.Class.prototype={mixinPrototypes:[],delegate:Core.delegate,getMixin:function(a){return this.getMixins()[a]},getMixins:function(){return this.mixinPrototypes||{}}};Core.apply(Core.Class,{extend:function(a){Core.constructing=!0;var b=new this,c=this.prototype;delete Core.constructing;Core.apply(b,a);var d=b.constructor=function(){!Core.constructing&&this.init&&this.init.apply(this,arguments)};b.superclass=c;Core.apply(d,
{prototype:b,constructor:d,ancestor:this,extend:this.extend,mixin:this.mixin});a.mixins&&this.mixin(a.mixins);return d},mixin:Core.mixin});Core.apply(Core,{Array:function(){var a={clear:function(){this.length=0;return this},map:function(a,c){for(var d=Array(this.length),e=0,f=this.length;e<f;e++)e in this&&(d[e]=a.call(c,this[e],e,this));return d},invoke:function(a){var c=Array.prototype.slice.call(arguments,1);return this.map(function(d){return d[a].apply(d,c)})},filter:function(a){for(var c=[],
d=0,e=this.length;d<e;++d)a.call(this,this[d],d,this)&&c.push(this[d]);return c},clean:function(){return this.filter(function(a){return null===a?!1:a.length})},contains:function(a){for(var c=this.length;c--;)if(this[c]===a)return!0;return!1}};return{get:function(b){Core.apply(b,a);return b}}}()});Core.apply(Core,{namespace:function(){return Core.apply(Core,{register:function(a,b,c){for(var d=a.split("."),e=0;e<d.length;e++)a=d[e],this.exists(a,b)||(b[a]=c),b=b[a];return b},exists:function(a,b){return!b||
typeof b[a]==="undefined"?!1:!0},autoload:function(a,b){var c={},d=function(b){if(Core.pattern.isURI(a))b=a;else{var d=[];if((relative=/((..\/)+)/i.exec(b))&&relative.length)relative=relative.shift(),b=b.substring(relative.length),d.push(relative);d.push(Core.Array.get(b.split(".")).invoke("toLowerCase").join("/"));b=d.join("")}c[b]=[]};if(Core.pattern.isFilemap(a))c=a;else if(Core.pattern.isString(a))d(a);else for(var e in a)d(a[e]);Core.loader.addScripts(c).autoload(b)}})}(),extend:function(a){return Core.Class.extend(a)},
override:function(a,b){Core.apply(a.prototype,b)},define:function(a,b){return this.namespace.register(a,window,b)},require:function(a,b){this.namespace.autoload(a,b)},loader:function(){var a={},b=[],c=0,d={path:null,basePath:null,cache:!0,dataType:"script",type:".js",method:"GET"};return{setConfig:function(a){$.extend(d,a);return this},getConfig:function(){return d},addScripts:function(b){a=$.extend(!0,{},a,b);return this},loadScript:function(a,c,h){var g=b[a]||(b[a]={loaded:!1,callbacks:[]});if(g.loaded)return c.apply(h);
g.callbacks.push({fn:c,context:h});g.callbacks.length==1&&(c=[],c.push(d.path),c.push(d.basePath),c.push(a+(d.type||"")),$.ajax({type:d.method,url:Core.Array.get(c).clean().join("/"),dataType:d.dataType,cache:d.cache,success:function(){g.loaded=!0;$.each(g.callbacks,function(){this.fn.apply(this.context)});g.callbacks.length=0}}))},clear:function(){this.queue.clear();return this},queue:function(){var c=function(a){-1==$.inArray(a,b)&&a.length&&b.push(a)};$.each(a,function(a,b){$.each(b,function(a,
b){c(b)});c(a)});return this},autoload:function(a){this.path();this.queue();(function(){if(c==b.length)return a.apply(window);Core.loader.loadScript(b[c++],arguments.callee)})()},path:function(a){if(!d.path){var c=$("script").filter(function(){return this.src.indexOf(a)!=-1}).eq(0);if(c.size())d.path=c.attr("src").slice(0,-1-a.length)}return function(){return d.path}}("core.js")}}(),preloader:function(){var a=[],b=[],c=0,d={cache:!0,parallel:!0},e={start:0,end:0};return{onComplete:function(){},images:function(){return b},
reset:function(){a=[];b=[];c=0;return this},queue:function(c){Core.pattern.isString(c)?a.push(c):$.each(c,function(c,b){a.push(b)});return this},finish:function(a,d,g){c--;b[d].size={width:g.width,height:g.height};if(0==c)e.end=(new Date).getTime(),this.onComplete.apply(this,[{time:((e.end-e.start)/1E3).toPrecision(2)}])},preload:function(f){this.onComplete=f||this.onComplete;e.start=(new Date).getTime();for(c=i=a.length;i--;)f=new Image,f.onload=Core.delegate(this,this.finish,$.browser.msie&&$.browser.version<=
8?[window.event,i,f]:[i,f]),f.onerror=Core.delegate(this,this.finish,$.browser.msie&&$.browser.version<=8?[window.event,i,f]:[i,f]),f.onabort=Core.delegate(this,this.finish,$.browser.msie&&$.browser.version<=8?[window.event,i,f]:[i,f]),f.src=d.cache?a.shift():a.shift()+"?u="+(new Date).getTime(),b.push({index:i,image:f,size:{width:0,height:0}})},preloadCssImages:function(a){this.queue(this.getCssImages()).preload(a)},getCssRules:function(){for(var a=[],c={},b={rules:function(b){for(var d=b.length;d--;)c=
{rule:b[d],selectorText:!b[d].selectorText?null:b[d].selectorText,declaration:b[d].cssText?b[d].cssText:b[d].style.cssText},a.push(c)}},d=document.styleSheets.length;d--;){var e={rules:document.styleSheets[d].rules||document.styleSheets[d].cssRules,imports:document.styleSheets[d].imports||[]};b.rules(e.rules);for(x=0;x<e.imports;x++)b.rules(document.styleSheets[x].imports[x].rules||document.styleSheets[d].imports[x].cssRules)}return a},getCssImages:function(){for(var a=this.getCssRules(),c=a.length,
b=[],d=RegExp("[^(|'\"]+.(gif|jpg|jpeg|png)","ig");c--;){var e=a[c].declaration.match(d);e.length&&b.push(e)}return b}}}()});Core.validator=function(){var a={form:null,map:{}},b=Core.Array.get(["required","message","element","error"]);return{tooltip:function(){return(new (Core.extend({tooltip:null,create:function(){this.tooltip=$("<div/>").addClass("coretip");return this},empty:function(){this.tooltip.empty()},content:function(a){this.tooltip.html(a);return this},open:function(a){var b=a.offset();
this.tooltip.css({top:b.top,left:b.left+a.width()+15,opacity:0.95}).appendTo("body").fadeIn(200)},close:function(){this.tooltip.remove()}}))).create()},display:function(){var b=!1;$("div.coretip").remove();$.each(a.map,function(a,e){e.error?(b=!0,e.element.addClass("invalid"),e.tooltip.content(e.message).open(e.element)):(e.element.removeClass("invalid"),e.tooltip.close())});b?a.form.find(":submit").parent().click(!1).fadeTo(200,0.5):a.form.find(":submit").parent().unbind("click").fadeTo(200,1)},
map:function(b,d){a.form=$(b);$.each(d,function(b,c){a.map[b]=$.extend({error:!1,message:null,tooltip:Core.validator.tooltip()},c)});return this},auto:function(){a.form.find(":input").unbind("blur").bind({blur:Core.delegate(this,this.valid)});return this},valid:function(){$.each(a.map,Core.delegate(this,this.filter));this.display()},filter:function(a,b){var e=$(":input[name="+a+"]");b.required&&$.each(b,Core.delegate(this,this.check,[a,e]))},check:function(c,d,e,f){var h=!1;b.contains(c)||(Core.pattern.isFunction(d)&&
(d=d.apply(this,[f.val()])),d!==this[c].apply(this,[f.val(),f])&&(h=!0),$.extend(!0,a.map[e],{error:h,element:f}))},empty:function(a){return null===a?!1:a.length==0?!0:!1},email:function(a){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(a)},alnum:function(){return!0},digit:function(a){return Core.pattern.isNumber(a)},alpha:function(){return!1},lower:function(a){return a==a.toLowerCase()},upper:function(a){return a==a.toUpperCase()},extend:function(a){Core.apply(this,a);return this},
password:function(){return!0},checked:function(a,b){return b.is(":checked")?!0:!1},positive:function(a){return parseInt(a)>0?!0:!1},negative:function(a){return parseInt(a)<0?!0:!1},zero:function(a){return parseInt(a)===0?!0:!1},equalTo:function(){return!0},strcmp:function(a,b){return a==b?0:a>b?1:-1}}}();Core.jQuery=function(){return{plugin:function(a,b){$.fn[a]=function(c){var d=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=$.data(this,a);e?e[c].apply(e,d):$.data(this,
a,new b(c,this))})}},widget:function(a,b){return $.widget(a,b.prototype)}}}();Core.widget={tree:{options:{items:"li",draggable:{handle:" > div",addClasses:!1,helper:"clone",zIndex:100,opacity:0.8,refreshPositions:!0},droppable:{accept:"li",tolerance:"pointer",refreshPositions:!0},folder:null},init:function(a,b){var c=$("<div/>").addClass("placeholder"),b=$(b);c.prependTo(b).css({height:2});this.refresh()},drop:function(a,b){var c=$(a.target).parent(),d=!$(a.target).hasClass("placeholder");d&&c.children("ol").length==
0&&c.append("<ol/>");d?c.addClass("ui-state-expanded").removeClass("ui-state-collapsed").children("ol").append(b.draggable).show(200):c.before(b.draggable);$("ol.sortable li.ui-state-expanded").not(":has(li:not(.ui-draggable-dragging))").removeClass("ui-state-expanded");c.find(".placeholder").removeClass("placeholder-active").find(">div").removeClass("ui-droppable-active");this.clear(this.element);this.refresh();this.history.commit()},over:function(a){$(a.target).filter("div:not(.placeholder)").addClass("ui-droppable-active").parent().children("ol").show(200).each(function(){$(this).parent().addClass("ui-parent-expanded")});
$(a.target).filter(".placeholder").addClass("placeholder-active")},out:function(a){$(a.target).filter("div").removeClass("ui-droppable-active");$(a.target).filter(".placeholder").removeClass("placeholder-active")},refresh:function(){this.element.find("ol:hidden").each(function(){$(this).parent().addClass("ui-parent-collapsed")});this.element.find("ol:visible").each(function(){$(this).parent().addClass("ui-parent-collapsed ui-parent-expanded")});return this},clear:function(a){a.find("ol").filter(function(){return $(this).children().size()==
0}).remove();this.serialize.serialize(this.element)},log:function(a,b){var c=$(a.target);$(b.helper).addClass("ui-draggable-helper");this.history.saveState(c)},undo:function(a){if(a.ctrlKey&&(a.which==122||a.which==26))this.history.restoreState(),this.refresh()},toggle:function(a){$(a.target).parents("li:first").toggleClass("ui-parent-expanded").children("ol").toggle(200);return!1},_create:function(){this.options.draggable=$.extend({},this.options.draggable,{start:Core.delegate(this,this.log),delay:200});
this.options.droppable=$.extend({},this.options.droppable,{drop:Core.delegate(this,this.drop),over:Core.delegate(this,this.over),out:Core.delegate(this,this.out)});this.element.find(this.options.items).each(Core.delegate(this,this.init)).bind("click",Core.delegate(this,this.toggle)).bind({mouseenter:Core.delegate(this.smartControl,this.smartControl.append,[this.options]),mouseleave:Core.delegate(this.smartControl,this.smartControl.remove)}).draggable(this.options.draggable).end().find("div, .placeholder").droppable(this.options.droppable).disableSelection();
$(document).bind("keypress",Core.delegate(this,this.undo));this.serialize.serialize(this.element)},smartControl:function(){var a=Core.extend({options:{folder:null},activate:function(a){var c=a.attr("data-id"),d=$("<div/>").addClass("smart fix");$.each([$("<a/>",{href:this.options.folder+"/edit.php?id="+c}).addClass("edit"),$("<a/>",{href:this.options.folder+"/delete.php?id="+c}).bind("click",function(){return confirm("Are you sure?")}).addClass("delete")],function(){$(this).addClass("smart-link").bind("click",
function(a){a.stopPropagation()}).appendTo(d)});d.appendTo(a)},deactivate:function(a){a.find(".smart").remove()},setOptions:function(a){$.extend(this.options,a);return this}});return{element:null,control:function(){if(null==this.element)this.element=new a;return this.element},append:function(a,c){var d=this.getTarget(a);this.control().setOptions(c).activate(d)},remove:function(a){a=this.getTarget(a);this.control().deactivate(a)},getTarget:function(a){return $(a.target).is("li")?$(a.target):$(a.target).parents("li:first")}}}(),
history:function(){return{stack:[],temp:null,saveState:function(a){this.temp={item:a,itemParent:a.parent(),itemAfter:a.prev()}},commit:function(){this.temp!=null&&this.stack.push(this.temp)},restoreState:function(){var a=this.stack.pop();a!=null&&(a.itemAfter.length>0?a.itemAfter.after(a.item):a.itemParent.prepend(a.item))}}}(),serialize:function(){return{level:1,sequence:1,items:[],serialize:function(a){this.level=1;this.sequence=2;a.children().each(Core.delegate(this,this.boundaries,[this.level]))},
boundaries:function(a,b,c){a={element:$(b),level:c++,left:this.sequence++,right:null,parent:$(b).parents("li:first[id]").attr("id")};a.element.children("ol").children(":not(.ui-draggable-helper)").each(Core.delegate(this,this.boundaries,[c]));a.right=this.sequence++;this.items.push(a)}}}()}}})(jQuery,window);